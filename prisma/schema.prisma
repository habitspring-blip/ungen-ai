generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id        String   @id @db.Uuid
  email     String?  @db.VarChar(255)
  credits   Int?     @default(1000)
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  documents Document[]
  summaries Summary[]
  feedback  Feedback[]
  usageLogs UsageLog[]

  @@map("users")
}

model Document {
  id           String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId       String?   @map("user_id") @db.Uuid
  originalText String    @map("original_text")
  preprocessed Json?
  fileName     String?   @map("file_name")
  fileType     String?   @map("file_type")
  language     String?   @default("en")
  status       String?   @default("ready")
  metadata     Json?
  createdAt    DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime? @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)
  user         User?     @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  summaries    Summary[]

  @@index([userId], map: "idx_documents_user_id")
  @@map("documents")
}

model Summary {
  id             String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  documentId     String?    @map("document_id") @db.Uuid
  userId         String?    @map("user_id") @db.Uuid
  summaryText    String     @map("summary_text")
  method         String?
  config         Json?
  metrics        Json?
  modelVersion   String?    @map("model_version")
  processingTime Int?       @map("processing_time")
  confidence     Float?
  createdAt      DateTime?  @default(now()) @map("created_at") @db.Timestamptz(6)
  feedback       Feedback[]
  document       Document?  @relation(fields: [documentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user           User?      @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([userId], map: "idx_summaries_user_id")
  @@map("summaries")
}

model Feedback {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  summaryId     String?   @map("summary_id") @db.Uuid
  userId        String?   @map("user_id") @db.Uuid
  rating        Int?
  feedback_type String?
  editedSummary String?   @map("edited_summary")
  comments      String?
  createdAt     DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  summary       Summary?  @relation(fields: [summaryId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user          User?     @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([userId], map: "idx_feedback_user_id")
  @@map("feedback")
}

model UsageLog {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId          String    @map("user_id") @db.Uuid
  action          String?
  documentId      String?   @map("document_id") @db.Uuid
  summaryId       String?   @map("summary_id") @db.Uuid
  processingTime  Int?      @map("processing_time")
  tokensUsed      Int?      @map("tokens_used")
  createdAt       DateTime? @default(now()) @map("created_at") @db.Timestamptz(6)
  user            User      @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([userId], map: "idx_usage_logs_user_id")
  @@map("usage_logs")
}
